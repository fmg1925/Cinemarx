<div class="movie">
  <div class="movie-left">
    <% user_rating = current_user&.ratings&.find_by(movie_id: movie['id'])&.score || 0 %>
    <% favorite = current_user&.favorite_movies&.find_by(movie_id: movie['id']) || false %>
    <div class="poster-wrapper" data-movie-id="<%= movie["id"] %>" vote-count="<%= movie['vote_count'] %>" vote-average="<%= movie['vote_average'] %>" ratings-text="<%= t('ratings') %>" title="<%= movie['title'] %>" overview="<%= movie['overview'] %>" poster_path="<%= movie['poster_path'] %>">
      <%= form_tag store_movies_path, method: :post, data: { turbo: false } do %>
      <%= hidden_field_tag 'movie[id]', movie['id'] %>
      <%= hidden_field_tag 'movie[title]', movie['title'] %>
      <%= hidden_field_tag 'movie[overview]', movie['overview'] %>
      <%= hidden_field_tag 'movie[poster_path]', movie['poster_path'] %>
      <%= hidden_field_tag 'movie[vote_average]', movie['vote_average'] %>
      <%= hidden_field_tag 'movie[vote_count]', movie['vote_count'] %>
      <%= hidden_field_tag 'movie[rating]', movie['rating'] %>
      <%= hidden_field_tag 'movie[total_votes]', movie['total_votes'] %>

      <%= button_tag type: 'submit', style: "background:none; border:none; padding:0;" do %>
        <%= image_tag(
          movie['poster_path'] ? "https://image.tmdb.org/t/p/w500#{movie['poster_path']}" : asset_path('placeholder.png'),
          class: "movie-poster"
        ) %>
      <% end %>
      <%= button_tag(favorite ? '💛' : '❤️', class: "poster-button", type: 'button') %>
      <% end %>
    </div>
  </div>
  <div class="movie-details">
    <strong><%= movie['title'] %></strong><br>
    <%= movie['overview'] %><br>
  </div>
  <% if movie["user_score"].present? %>
    <p><%= t("users.your_rating") %> <%= movie["user_score"] %> <%= t("stars") %></p>
    <p><%= t("users.rating") %> <%= movie["rating"] %> / 5</p>
    <p><%= t("users.total_users") %> <%= movie["total_votes"] %></p>
  <% end %>
</div>

<%= javascript_include_tag "movies", "data-turbo-track": "reload", defer: true %>